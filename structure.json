{
  "public": {
    "index.html": "<!DOCTYPE html>\n<html lang=\"es\">\n<head>\n  <!-- Bootstrap CSS -->\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Búsqueda de Recetas en Dofus - Calculador de Ganancias</title>\n\n  <!-- SEO Básico -->\n  <meta name=\"description\" content=\"Buscador de recetas de objetos de Dofus. Calcula tus ganancias de forma rápida y sencilla.\">\n  <meta name=\"keywords\" content=\"Dofus, recetas, objetos, kamas, búsqueda, economía, alquimia, herrero, crudo, oficio\">\n  <meta name=\"robots\" content=\"index, follow\">\n  <meta name=\"author\" content=\"Jorge Fernández Rojo Andrés\">\n  <link rel=\"canonical\" href=\"https://recetasdofus.com.ar\">\n\n  <!-- Open Graph -->\n  <meta property=\"og:title\" content=\"Búsqueda de Recetas - Recetas Dofus\">\n  <meta property=\"og:description\" content=\"Calculá cuánto ganás al fabricar objetos en Dofus.\">\n  <meta property=\"og:image\" content=\"https://recetasdofus.com.ar/images/favicon.png\">\n  <meta property=\"og:url\" content=\"https://recetasdofus.com.ar\">\n  <meta property=\"og:type\" content=\"website\">\n\n  <link rel=\"stylesheet\" href=\"css/style.css\">\n  <link rel=\"icon\" href=\"images/favicon.png\" type=\"image/png\">\n  \n  <!-- Google tag (gtag.js) -->\n  <script async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8948109105283119\" crossorigin=\"anonymous\"></script>\n  <script async src=\"https://www.googletagmanager.com/gtag/js?id=G-GHSB8ZF8WD\"></script>\n  <!-- Google Tag Manager y Consent Mode (ver archivos: gtag-init.js, consent-mode.js, gtag-config.js) -->\n  \n   <script src=\"js/gtag-init.js\"></script>\n   <script src=\"js/consent-mode.js\"></script>\n  <script src=\"js/gtag-config.js\"></script>\n</head>\n  <!-- contador de visitas en su propio bloque -->\n<div class=\"visit-counter\">\n  <span id=\"contador-visitas\">Usuarios hasta el momento: 0</span>\n\n</div>\n<body>\n\n<!-- Barra de navegación -->  \n  <nav class=\"navbar navbar-expand-lg navbar-dark bg-dark\">  \n    <div class=\"container\">  \n      <a class=\"navbar-brand\" href=\"index.html\">Recetas Dofus</a>  \n      <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">  \n        <span class=\"navbar-toggler-icon\"></span>  \n      </button>  \n      <div class=\"collapse navbar-collapse\" id=\"navbarNav\">  \n        <ul class=\"navbar-nav me-auto\">  \n          <li class=\"nav-item\">  \n            <a class=\"nav-link active\" href=\"index.html\">Inicio</a>  \n          </li>  \n          <li class=\"nav-item\">  \n            <a class=\"nav-link\" href=\"blog.html\">Blog</a>  \n          </li>  \n        </ul>  \n        <div class=\"d-flex\">  \n          <!-- Botones para NO logueados -->  \n          <button id=\"btnRedirectLogin\" class=\"btn btn-outline-light me-2\" hidden>Iniciar Sesión</button>  \n          <button id=\"btnRedirectRegister\" class=\"btn btn-warning\" hidden>Registrarse</button>  \n            \n          <!-- Botones para logueados -->  \n          <button id=\"btnUltimasRecetas\" class=\"btn btn-outline-light me-2\" hidden>Últimas Recetas</button>  \n          <button id=\"btnVolversePremium\" class=\"btn btn-warning me-2\" hidden>Volverse Premium</button>  \n          <button id=\"btnBeneficios\" class=\"btn btn-outline-light me-2\" hidden>Ver Beneficios Premium</button>  \n          <button id=\"btnLogout\" class=\"btn btn-danger\" hidden>Cerrar Sesión</button>  \n        </div>\n          \n      </div>  \n    </div>\n      \n  </nav> \n<!-- Nueva sección introductoria -->\n<section class=\"container mt-5 d-flex justify-content-center\">\n  <div class=\"p-4 bg-white rounded shadow\" style=\"max-width: 600px;\">\n    <h2 class=\"text-center\">¿Qué es Recetas Dofus?</h2>\n    <p class=\"mt-3\">\n      Recetas Dofus es una herramienta gratuita pensada para los jugadores de Dofus que desean maximizar sus ganancias dentro del juego. \n      Buscá recetas de objetos, calculá tus costos de fabricación y estimá tus ganancias de forma rápida y sencilla.\n    </p>\n  </div>\n</section>\n\n<h1 class=\"text-center mt-4\">Buscador de Recetas en Dofus y Calculador de Ganancias</h1>\n\n<!-- Formulario de búsqueda -->\n<form id=\"searchForm\" class=\"text-center mt-3\">\n  <label for=\"objectName\">Nombre del objeto:</label>\n  <input type=\"text\" id=\"objectName\" placeholder=\"Buscar receta\" required>\n  <button type=\"submit\" class=\"btn btn-warning\">Buscar</button>\n</form>\n<!-- 📢 Bloque de anuncio AdSense -->\n<div class=\"d-flex justify-content-center my-4\">\n  <!-- anuncio_index_superior -->\n  <ins class=\"adsbygoogle\"\n       style=\"display:block; width: 100%; min-height: 90px\"\n       data-ad-client=\"ca-pub-8948109105283119\"\n       data-ad-slot=\"9450520549\"\n       data-ad-format=\"auto\"\n       data-full-width-responsive=\"true\"></ins>\n</div>\n\n<script>\n  window.addEventListener('load', () => {\n    (adsbygoogle = window.adsbygoogle || []).push({});\n  });\n</script>\n\n</div>\n\n<!-- Contenedor principal -->\n<main class=\"container\">\n  <section id=\"recipeSummary\" class=\"section scale-up-horizontal-center\">\n    <h2 id=\"nombreObjeto\"></h2>\n    <h3>Precio de Venta:</h3>\n    <input type=\"number\" id=\"precioObjeto\" class=\"price-input\" placeholder=\"Ingrese precio\" oninput=\"calcularGanancia()\">\n    <h3>Receta:</h3>\n    <ul id=\"ingredientes\"></ul>\n    <h3>Gasto: <span id=\"gasto\">0</span> K</h3>\n    <h3>Ganancia: <span id=\"ganancia\">0</span> K</h3>\n  </section>\n\n  <section id=\"calculationDetails\" class=\"section scale-up-horizontal-center\">\n    <h3>Cantidad a fabricar:</h3>\n    <input type=\"number\" id=\"cantidadFabricar\" value=\"1\" min=\"1\" class=\"price-input\" oninput=\"calcularGanancia()\">\n    <h3>Ganancia Total: <span id=\"gananciaTotal\">0</span> K</h3>\n    <h3>Gasto Total: <span id=\"gastoTotal\">0</span> K</h3>\n    <h3>Ingredientes Totales Necesarios:</h3>\n    <ul id=\"ingredientesTotales\"></ul>\n  </section>\n\n  <!-- Nueva sección de \"Cómo funciona\" -->\n  <section class=\"container mt-5 d-flex justify-content-center\">\n    <div class=\"p-4 bg-white rounded shadow\" style=\"max-width: 600px;\">\n      <h2 class=\"text-center\">¿Cómo funciona Recetas Dofus?</h2>\n      <p class=\"mt-3\">\n        Usar Recetas Dofus es sencillo: ingresá el nombre del objeto, obtené la receta, completá precios y calculá costos y ganancias automáticamente. \n        También podés calcular los ingredientes necesarios para producciones en masa.\n      </p>\n    </div>\n  </section>\n\n  <!-- Nueva sección de Preguntas Frecuentes -->\n  <section class=\"container mt-5 d-flex justify-content-center\">\n    <div class=\"p-4 bg-white rounded shadow\" style=\"max-width: 600px;\">\n      <h2 class=\"text-center\">Preguntas Frecuentes</h2>\n      <h5 class=\"mt-3\">1. ¿Esta herramienta es gratuita?</h5>\n      <p>Sí, Recetas Dofus es completamente gratuita para todos los usuarios.</p>\n\n      <h5 class=\"mt-3\">2. ¿Necesito registrarme para usarla?</h5>\n      <p>No es necesario registrarse para buscar recetas. El registro es opcional para acceder a funciones premium.</p>\n\n      <h5 class=\"mt-3\">3. ¿Los datos de precios se actualizan?</h5>\n      <p>Los datos se basan en la API de DofusDB, por lo que reflejan el contenido disponible más reciente.</p>\n    </div>\n  </section>\n  <!-- 🎮 Vista 3D temática Dofus -->\n<section class=\"container mt-5\">\n  \n  <div id=\"threeContainer\" style=\"width: 100%; height: 400px;\"></div>\n</section>\n\n</main>\n<footer class=\"text-center mt-5\">\n  <p>© 2025 Jorge Fernández Rojo Andrés - \n    <a href=\"mailto:jf_wolf_887@hotmail.com\">Contacto</a> | \n    <a href=\"privacidad.html\">Política de Privacidad</a> |\n    <a href=\"terminos.html\">Términos y Condiciones</a>\n  </p>\n  <div class=\"mt-3\">\n    <a href=\"https://www.youtube.com/@Yotaroto\" target=\"_blank\" rel=\"noopener noreferrer\">\n      <img src=\"images/youtube.png\" alt=\"YouTube\" width=\"32\" height=\"32\" style=\"margin-right: 10px;\">\n    </a>\n    <a href=\"https://www.linkedin.com/in/jorgeandresfernandezrojo/\" target=\"_blank\" rel=\"noopener noreferrer\">\n      <img src=\"images/linkedin-logo.png\" alt=\"LinkedIn\" width=\"32\" height=\"32\">\n    </a>\n  </div>\n</footer>\n<!-- Modal de Verificación -->\n<div class=\"modal fade\" id=\"verificacionModal\" tabindex=\"-1\" aria-labelledby=\"verificacionModalLabel\" aria-hidden=\"true\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h5 class=\"modal-title\" id=\"verificacionModalLabel\">⚠️ Cuenta no verificada</h5>\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Cerrar\"></button>\n      </div>\n      <div class=\"modal-body\">\n        <p>Tu cuenta todavía no está verificada. Revisá tu correo electrónico para completar la verificación.</p>\n        <p>¿No recibiste el correo? Podés solicitar uno nuevo haciendo clic en el botón de abajo.</p>\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cerrar</button>\n        <button type=\"button\" class=\"btn btn-primary\" id=\"btnReenviarVerificacion\">Reenviar correo de verificación</button>\n      </div>\n    </div>\n  </div>\n</div>\n\n<!-- Bootstrap Bundle con Popper -->\n<script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\n<script src=\"js/verificarSesion.js\"></script>\n<script type=\"module\" src=\"js/render.js\"></script>\n<script type=\"module\" src=\"js/calculo.js\"></script>\n<script type=\"module\" src=\"js/search.js\"></script>\n<script src=\"js/cookies-banner.js\"></script>\n<script src=\"js/language-toggle.js\"></script>\n<script src=\"https://unpkg.com/three@0.160.0/build/three.min.js\"></script>\n<script src=\"js/escenaDofus.js\"></script>\n<script>\n  fetch('/api/visitas')\n  .then(res => res.json())\n  .then(data => {\n    const contador = document.getElementById('contador-visitas');\n    contador.textContent = `Usuarios hasta el momento: ${data.total}`;\n\n  })\n  .catch(err => console.error('Error al cargar las visitas:', err));\n</script>\n</body>\n</html>\n"
  },
  "server.js": "const express = require('express');\r\nconst path = require('path');\r\nconst axios = require('axios');\r\nconst { obtenerIngredientes } = require('./src/utils/scraper');\r\nconst authRoutes = require('./src/routes/authRoutes');\r\nconst mongoose = require('mongoose');\r\nconst verificarToken = require('./src/middlewares/authMiddleware');\r\nconst blogRoutes = require('./src/routes/blogRoutes');\r\nconst visitasRoutes = require('./src/routes/visitas.routes');\r\n\r\nrequire('dotenv').config();\r\n\r\nconst app = express();\r\nconst DOFUSDB_API_URL = process.env.DOFUSDB_API_URL || \"https://api.dofusdb.fr/items\";\r\n\r\n// Función para quitar acentos\r\nfunction quitarAcentos(str) {\r\n  return str.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\");\r\n}\r\n\r\n// Middlewares\r\napp.use(express.static(path.join(__dirname, 'public')));\r\napp.use(express.json());\r\n\r\n// Rutas\r\napp.use('/api', blogRoutes);\r\napp.use('/api', authRoutes);\r\napp.use('/api', visitasRoutes);\r\n\r\n// Conexión MongoDB\r\nmongoose.connect(process.env.MONGO_URI)\r\n  .then(() => console.log('✅ Conectado correctamente a MongoDB Atlas'))\r\n  .catch(err => console.error('❌ Error al conectar a MongoDB Atlas:', err));\r\n\r\n// Ruta búsqueda recetas con fallback de acentos\r\napp.post('/api/recipes/search', async (req, res) => {\r\n  let { objectName } = req.body;\r\n\r\n  if (!objectName || !/^[\\p{L}0-9\\s+]+$/u.test(objectName)) {\r\n    return res.status(400).json({ success: false, error: 'El nombre del objeto es inválido o está vacío.' });\r\n  }\r\n\r\n  // Decodificar + a espacios\r\n  objectName = decodeURIComponent(objectName).replace(/\\+/g, ' ');\r\n\r\n  // Función interna para consultar la API externa\r\n  async function buscarEnApi(nombreBuscado) {\r\n  const formattedName = nombreBuscado.split(' ').join('+');\r\n  const url = `${DOFUSDB_API_URL}?slug.es[$search]=${formattedName}&level[$gte]=0&level[$lte]=200&lang=es`;\r\n\r\n  console.log(`[DEBUG] URL construida: ${url}`);\r\n\r\n  try {\r\n    const response = await axios.get(url, {\r\n      headers: {\r\n        accept: \"application/json, text/plain, */*\",\r\n        \"accept-language\": \"es-ES,es;q=0.9\",\r\n        Referer: \"https://dofusdb.fr/\",\r\n      },\r\n    });\r\n\r\n    if (response.data.data.length === 0) {\r\n      console.log(`[INFO] No se encontraron resultados para: ${nombreBuscado}`);\r\n      return null;\r\n    }\r\n\r\n    const item = response.data.data[0];\r\n    const recipeDetails = await obtenerIngredientes(item.id);\r\n\r\n    return {\r\n  name: item.name?.es || 'Nombre no disponible',\r\n  description: item.description?.es || '', // ✅ Agregado\r\n  recipe: recipeDetails,\r\n  image: item.img || \"/default-image.png\"\r\n};\r\n\r\n  } catch (error) {\r\n    console.error('[ERROR] Error al buscar la receta:', error.message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n\r\n  try {\r\n    // Primero busco con el nombre original\r\n    let resultado = await buscarEnApi(objectName);\r\n\r\n    // Si no encontró, busco sin acentos (fallback)\r\n    if (!resultado) {\r\n      const nombreSinAcentos = quitarAcentos(objectName);\r\n      resultado = await buscarEnApi(nombreSinAcentos);\r\n    }\r\n\r\n    if (!resultado) {\r\n      return res.json({ success: true, data: null });\r\n    }\r\n\r\n    res.json({ success: true, data: resultado });\r\n\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, error: 'Error al buscar la receta.' });\r\n  }\r\n});\r\n\r\n// Ruta protegida perfil\r\napp.get('/api/perfil', verificarToken, (req, res) => {\r\n  res.json({\r\n    message: 'Perfil accedido correctamente',\r\n    usuario: req.user\r\n  });\r\n});\r\n\r\n// Servidor\r\nconst PORT = process.env.PORT || 3000;\r\napp.listen(PORT, () => {\r\n  console.log(`🚀 Servidor corriendo en http://localhost:${PORT}`);\r\n});\r\n",
  "src": {
    "controllers": {
      "visitas.controller.js": "const Visita = require('../models/visita.model');\r\n\r\nexports.contarVisita = async (req, res) => {\r\n  try {\r\n    const ip = req.headers['x-forwarded-for']?.split(',')[0]?.trim() || req.socket.remoteAddress || 'desconocida';\r\n\r\n    // Aseguramos que la IP no sea vacía\r\n    if (!ip) {\r\n      return res.status(400).json({ message: 'No se pudo obtener la IP' });\r\n    }\r\n\r\n    const hoy = new Date();\r\n    hoy.setHours(0, 0, 0, 0);\r\n\r\n    // Buscar visitas del día actual\r\n    const yaContada = await Visita.findOne({\r\n      ip,\r\n      fecha: { $gte: hoy }\r\n    });\r\n\r\n    // Guardar solo si no está registrada hoy\r\n    if (!yaContada) {\r\n      await Visita.create({ ip, fecha: new Date() });\r\n    }\r\n\r\n    // Contar visitas históricas (sin filtrar por fecha)\r\n    const total = await Visita.countDocuments();\r\n\r\n    console.log('[DEBUG] Total visitas:', total);\r\n    res.json({ total });\r\n\r\n  } catch (error) {\r\n    console.error('[ERROR] al contar visitas:', error.message);\r\n    res.status(500).json({ message: 'Error al contar visitas' });\r\n  }\r\n};\r\n"
    },
    "models": {
      "visita.model.js": "const mongoose = require('mongoose');\r\n\r\nconst visitaSchema = new mongoose.Schema({\r\n  ip: {\r\n    type: String,\r\n    required: true,\r\n    trim: true\r\n  },\r\n  fecha: {\r\n    type: Date,\r\n    default: Date.now,\r\n    index: true\r\n  }\r\n});\r\n\r\nmodule.exports = mongoose.model('Visita', visitaSchema);\r\n"
    },
    "routes": {
      "visitas.routes.js": "const express = require('express');\r\nconst { contarVisita, totalUsuariosUnicos } = require('../controllers/visitas.controller');\r\n\r\nconst router = express.Router();\r\n\r\nrouter.get('/visitas', contarVisita);\r\nrouter.get('/usuarios-unicos', totalUsuariosUnicos); // 👈 nueva ruta\r\n\r\nmodule.exports = router;\r\n"
    }
  }
}